{% extends 'main/update.html' %}

{% block model%}rent{% endblock %}

{% block form_fields%}
  <div class="form-group">
    {{form.library.label_tag}} {{form.library}}
  </div>
  <div class="form-group">
    {{form.book.label_tag}} {{form.book}}
  </div>
  <div class="form-group">
    {{form.customer.label_tag}} {{form.customer}}
  </div>
  <div class="form-group">
    {{form.employee.label_tag}} {{form.employee}}
  </div>
  <div class="form-group">
    {{form.due_date.label_tag}} {{form.due_date}}
  </div>
{% endblock %}

{% block extra_scripts %}
  <script>
    $(document).ready(function(){
      var selectedLibrary = document.getElementById('librarySelect').value;
  
      $.ajax({
          url: '/libraries/rent/ajax/getLibrary/' + selectedLibrary,
          success: function(data){
              var books = JSON.parse(data.books)
              var bookSelect = $('#bookSelect');
              bookSelect.empty();
              $.each(books, function(index, book){
                  bookSelect.append('<option value="' + book.pk + '">' + book.fields.title + '</option>');
              });
              bookSelect.val({{ selected_book }});
  
              var customers = JSON.parse(data.customers)
              var customerSelect = $('#customerSelect');
              customerSelect.empty();
              $.each(customers, function(index, customer){
                  customerSelect.append('<option value="' + customer.pk + '">' + customer.fields.first_name + ' ' + customer.fields.last_name + '</option>');
              });
              customerSelect.val({{ selected_customer }});
  
              var employees = JSON.parse(data.employees)
              var employeeSelect = $('#employeeSelect');
              employeeSelect.empty();
              $.each(employees, function(index, employees){
                  employeeSelect.append('<option value="' + employees.pk + '">' + employees.fields.first_name + ' ' + employees.fields.last_name + '</option>');
              });
              employeeSelect.val({{ selected_employee }});
          }
      });
  
      $('#librarySelect').on('change', function() {
          var selectedValue = $(this).val();
          $.ajax({
              url: '/libraries/rent/ajax/getLibrary/' + selectedValue,
              success: function(data){
                  var books = JSON.parse(data.books)
                  var bookSelect = $('#bookSelect');
                  bookSelect.empty();
                  bookSelect.append('<option value="">---------</option>')
                  $.each(books, function(index, book){
                      bookSelect.append('<option value="' + book.pk + '">' + book.fields.title + '</option>');
                  });
  
                  var customers = JSON.parse(data.customers)
                  var customerSelect = $('#customerSelect');
                  customerSelect.empty();
                  customerSelect.append('<option value="">---------</option>')
                  $.each(customers, function(index, customer){
                      customerSelect.append('<option value="' + customer.pk + '">' + customer.fields.first_name + ' ' + customer.fields.last_name + '</option>');
                  });
  
                  var employees = JSON.parse(data.employees)
                  var employeeSelect = $('#employeeSelect');
                  employeeSelect.empty();
                  employeeSelect.append('<option value="">---------</option>')
                  $.each(employees, function(index, employees){
                      employeeSelect.append('<option value="' + employees.pk + '">' + employees.fields.first_name + ' ' + employees.fields.last_name + '</option>');
                  });
              }
          });
      });
    });
  </script>
{% endblock %}