{% extends 'main/update.html' %}

{% block model%}rent{% endblock %}

{% block form_fields%}
  <div class="form-group row">
    <div class="col-sm-8">
      {{form.library.label_tag}} {{form.library}}
    </div>
    <div class="col-sm-4 align-self-end">
      <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#createLibraryModal"><i class="bi bi-plus-circle"></i></button>
    </div>
  </div>
  <div class="form-group row">
    <div class="col-sm-8">
      {{form.book.label_tag}} {{form.book}}
    </div>
    <div class="col-sm-4 align-self-end">
      <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#createBookModal"><i class="bi bi-plus-circle"></i></button>
    </div>
  </div>
  <div class="form-group row">
    <div class="col-sm-8">
      {{form.customer.label_tag}} {{form.customer}}
    </div>
    <div class="col-sm-4 align-self-end">
      <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#createCustomerModal"><i class="bi bi-plus-circle"></i></button>
    </div>
  </div>
  <div class="form-group row">
    <div class="col-sm-8">
      {{form.employee.label_tag}} {{form.employee}}
    </div>
    <div class="col-sm-4 align-self-end">
      <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#createEmployeeModal"><i class="bi bi-plus-circle"></i></button>
    </div>
  </div>
  <div class="form-group">
    {{form.amount_to_rent.label_tag}} {{form.amount_to_rent}}
  </div>
  <div class="form-group">
    {{form.due_date.label_tag}} {{form.due_date}}
  </div>
{% endblock %}

{% block modals %}
  <div class="modal fade" id="createLibraryModal" tabindex="-1" role="dialog" aria-labelledby="createLibraryModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-scrollable modal-dark" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body" id="libraryBodyModal">
          {% include 'library/library_create_form.html' with form=library_form %}
        </div>
      </div>
    </div>
  </div>
  
  <div class="modal fade" id="createBookModal" tabindex="-1" role="dialog" aria-labelledby="createBookModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-scrollable modal-dark" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body" id="bookBodyModal">
          {% include 'book/book_create_form.html' with form=book_form %}
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="createCustomerModal" tabindex="-1" role="dialog" aria-labelledby="createCustomerModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-scrollable modal-dark" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body" id="customerBodyModal">
          {% include 'customer/customer_create_form.html' with form=customer_form %}
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="createEmployeeModal" tabindex="-1" role="dialog" aria-labelledby="createEmployeeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-scrollable modal-dark" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body" id="employeeBodyModal">
          {% include 'employee/employee_create_form.html' with form=employee_form %}
        </div>
      </div>
    </div>
  </div>
{% endblock %}

{% block extra_scripts %}
  <script>
    $(document).ready(function(){
      var selectedLibrary = document.getElementById('librarySelect').value;
  
      $.ajax({
          url: '/libraries/rent/ajax/getLibrary/' + selectedLibrary,
          success: function(data){
              var books = JSON.parse(data.books)
              var bookSelect = $('#bookSelect');
              bookSelect.empty();
              $.each(books, function(index, book){
                  bookSelect.append('<option value="' + book.pk + '">' + book.fields.title + '</option>');
              });
              bookSelect.val({{ selected_book }});
  
              var customers = JSON.parse(data.customers)
              var customerSelect = $('#customerSelect');
              customerSelect.empty();
              $.each(customers, function(index, customer){
                  customerSelect.append('<option value="' + customer.pk + '">' + customer.fields.first_name + ' ' + customer.fields.last_name + '</option>');
              });
              customerSelect.val({{ selected_customer }});
  
              var employees = JSON.parse(data.employees)
              var employeeSelect = $('#employeeSelect');
              employeeSelect.empty();
              $.each(employees, function(index, employees){
                  employeeSelect.append('<option value="' + employees.pk + '">' + employees.fields.first_name + ' ' + employees.fields.last_name + '</option>');
              });
              employeeSelect.val({{ selected_employee }});
          }
      });
  
      $('#librarySelect').on('change', function() {
          var selectedValue = $(this).val();
          $.ajax({
              url: '/libraries/rent/ajax/getLibrary/' + selectedValue,
              success: function(data){
                  var books = JSON.parse(data.books)
                  var bookSelect = $('#bookSelect');
                  bookSelect.empty();
                  bookSelect.append('<option value="">---------</option>')
                  $.each(books, function(index, book){
                      bookSelect.append('<option value="' + book.pk + '">' + book.fields.title + '</option>');
                  });
  
                  var customers = JSON.parse(data.customers)
                  var customerSelect = $('#customerSelect');
                  customerSelect.empty();
                  customerSelect.append('<option value="">---------</option>')
                  $.each(customers, function(index, customer){
                      customerSelect.append('<option value="' + customer.pk + '">' + customer.fields.first_name + ' ' + customer.fields.last_name + '</option>');
                  });
  
                  var employees = JSON.parse(data.employees)
                  var employeeSelect = $('#employeeSelect');
                  employeeSelect.empty();
                  employeeSelect.append('<option value="">---------</option>')
                  $.each(employees, function(index, employees){
                      employeeSelect.append('<option value="' + employees.pk + '">' + employees.fields.first_name + ' ' + employees.fields.last_name + '</option>');
                  });
              }
          });
      });
    });
  </script>
  {% load static %}
  <script type="text/javascript" src="{% static 'main/js/libraryModal.js' %}"></script>
  <script type="text/javascript" src="{% static 'main/js/bookModal.js' %}"></script>
  <script type="text/javascript" src="{% static 'main/js/customerModal.js' %}"></script>
  <script type="text/javascript" src="{% static 'main/js/employeeModal.js' %}"></script>
{% endblock %}